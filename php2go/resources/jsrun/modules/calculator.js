if(document.layers)document.captureEvents(Event.KEYPRESS);document.onkeypress=calcKeyHandler;var Accum=0;var FlagNewNum=false;var PendingOp="";function calcKeyHandler(e){if(!e)e=window.event;var agent=navigator.userAgent.toLowerCase();var ie=(agent.indexOf("msie")!=-1&&agent.indexOf("opera")==-1);var mozilla=(agent.indexOf("mozilla")!=-1&&agent.indexOf("msie")==-1);var key=(ie?e.keyCode:(mozilla?e.which:null));if(key==null)return false;if(key>=48&&key<=57){numPressed(key-48);}else{switch(key){case 43:Operation('+');stopEvent(e);break;case 45:Operation('-');stopEvent(e);break;case 42:Operation('*');stopEvent(e);break;case 47:Operation('/');stopEvent(e);break;case 67:case 99:Clear();stopEvent(e);break;case 8:case 44:case 90:case 122:Backspace();stopEvent(e);break;case 13:case 61:Operation('=');stopEvent(e);break;case 46:Decimal();stopEvent(e);break;case 82:case 114:if(!e.ctrlKey&&!e.altKey){GetResult();stopEvent(e);}break;case 37:Percent();stopEvent(e);break;}}}function Backspace(){if(document.Keypad.ReadOut.value.length==1){document.Keypad.ReadOut.value="0";}else{document.Keypad.ReadOut.value=document.Keypad.ReadOut.value.substr(0,document.Keypad.ReadOut.value.length-1);}}function numPressed(Num){if(FlagNewNum){document.Keypad.ReadOut.value=Num;FlagNewNum=false;}else{if(document.Keypad.ReadOut.value=="0")document.Keypad.ReadOut.value=Num;else document.Keypad.ReadOut.value+=Num;}}function Operation(Op){var Readout=document.Keypad.ReadOut.value;if(FlagNewNum&&PendingOp!="=");else{FlagNewNum=true;if('+'==PendingOp)Accum+=parseFloat(Readout);else if('-'==PendingOp)Accum-=parseFloat(Readout);else if('/'==PendingOp)Accum/=parseFloat(Readout);else if('*'==PendingOp)Accum*=parseFloat(Readout);else Accum=parseFloat(Readout);document.Keypad.ReadOut.value=Accum;PendingOp=Op;}}function Decimal(){var curReadOut=document.Keypad.ReadOut.value;if(FlagNewNum){curReadOut="0.";FlagNewNum=false;}else{if(curReadOut.indexOf(".")==-1)curReadOut+=".";}document.Keypad.ReadOut.value=curReadOut;}function clearEntry(){document.Keypad.ReadOut.value="0";FlagNewNum=true;}function Clear(){Accum=0;PendingOp="";clearEntry();}function Neg(){document.Keypad.ReadOut.value=parseFloat(document.Keypad.ReadOut.value)*-1;}function Percent(){document.Keypad.ReadOut.value=(parseFloat(document.Keypad.ReadOut.value)/100)*parseFloat(Accum);}function GetResult(){var r,m;try{eval("target = parent.opener.document."+outerForm+".elements['"+outerField+"'];");}catch(e){return false;}if(outerMask.toUpperCase()=="CURRENCY"){formatCurrency(document.Keypad.ReadOut);}else{r=new RegExp("^FLOAT\-(\\d+):(\\d+)$");if(m=r.exec(outerMask.toUpperCase())){if(!checkFloat(m[1],m[2])){alert(p2gInvalidVal);return false;}}}target.value=document.Keypad.ReadOut.value;if(typeof(target.disable)=='undefined'||target.disabled==false){target.focus();}window.close();return true;}function formatCurrency(field){var newValue="";var negative=false;fieldValue=field.value;if(parseFloat(fieldValue)<0){negative=true;fieldValue=String(Math.abs(parseFloat(fieldValue)));}dotPos=fieldValue.indexOf(".");if(dotPos!=-1){if((dotPos+1)==(fieldValue.length-1))fieldValue=fieldValue+"0";fieldValue=fieldValue.substr(0,dotPos+3);fieldValue=fieldValue.replace(/\./g,"");}else{fieldValue=fieldValue+"00";}var inicio=fieldValue.substr(0,(fieldValue.length-2)%3);var resto=fieldValue.substr((fieldValue.length-2)%3,fieldValue.length-((fieldValue.length-2)%3)-2);var centavos=fieldValue.substr(fieldValue.length-2,2);if(negative){newValue=newValue+"-";}if(inicio!=""){newValue=newValue+inicio;}if(resto!=""){for(i=0;i<resto.length;i++){if(((i>0)&&((i%3)==0))||((i==0)&&(inicio!=""))){newValue=newValue+'.';}newValue=newValue+resto.charAt(i);}}if(fieldValue.length>=2){newValue=newValue+',';}newValue=newValue+centavos;field.value=newValue;}function checkFloat(l,r){var s=document.Keypad.ReadOut.value;var p=s.indexOf('.');var r=parseInt(r);if(p==-1){if(s.length>l)return false;else return true;}else{if(s.substring(0,p).length>l){return false;}else if((s.substring(p).length-1)>r){document.Keypad.ReadOut.value=s.substring(0,p+1)+s.substring(p+1,p+r+1);return true;}else{return true;}}}