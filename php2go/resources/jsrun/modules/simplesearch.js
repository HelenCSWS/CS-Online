var selMask="";var searchExpressions=new Array();var filterViewState=false;var filterDiv=null;var onlyFromCookie=false;function searchGetCookie(){var cf,co,cv,cm;var flist=document.simple_search.p2g_sfield;if((cf=getCookie('p2g_simple_search_fields'))&&(co=getCookie('p2g_simple_search_operators'))&&(cv=getCookie('p2g_simple_search_values'))){cfV=cf.split('|');coV=co.split('|');cvV=cv.split('|');for(var i=0;i<cfV.length;i++){var ok=false;for(var j=0;j<flist.options.length;j++){if(cfV[i]==flist.options[j].value){var exp=flist.options[j].text;for(var k=0;k<reportOpsA.length;k+=2){if(reportOpsA[k]==coV[i]){exp=exp+'|'+reportOpsA[k+1]+'|'+cvV[i]+'|'+cfV[i]+'|'+reportOpsA[k];if(!findExpression(exp)){searchExpressions[searchExpressions.length]=exp;ok=true;}}}if(!ok){for(var k=0;k<reportOpsB.length;k+=2){if(reportOpsB[k]==coV[i]){exp=exp+'|'+reportOpsB[k+1]+'|'+cvV[i]+'|'+cfV[i]+'|'+reportOpsB[k];if(!findExpression(exp)){searchExpressions[searchExpressions.length]=exp;}}}}}}}if(searchExpressions.length>0){onlyFromCookie=true;viewFilters();}}}function findExpression(expr){for(var i=0;i<searchExpressions.length;i++){if(searchExpressions[i]==expr)return true;}return false;}function checkSimpleSearch(){var send=(searchExpressions.length>0&&!onlyFromCookie);var resend=(!checkFields()&&searchExpressions.length>0&&onlyFromCookie&&confirm(reportFilResend));if(send||resend){document.simple_search.search_fields.value="";document.simple_search.search_operators.value="";document.simple_search.search_values.value="";var values=Array();for(i=0;i<searchExpressions.length;i++){var limiter=i>0?'|':'';values=searchExpressions[i].split('|');document.simple_search.search_fields.value=document.simple_search.search_fields.value+limiter+values[3];document.simple_search.search_operators.value=document.simple_search.search_operators.value+limiter+values[4];document.simple_search.search_values.value=document.simple_search.search_values.value+limiter+values[2];}setCookie('p2g_simple_search_fields',document.simple_search.search_fields.value,buildExpireDate(0,0,0,5));setCookie('p2g_simple_search_operators',document.simple_search.search_operators.value,buildExpireDate(0,0,0,5));setCookie('p2g_simple_search_values',document.simple_search.search_values.value,buildExpireDate(0,0,0,5));setCookie('p2g_simple_search_main_op',(document.simple_search.search_main_op[0].checked?'AND':'0R'),buildExpireDate(0,0,0,10));document.simple_search.submit();}else if(addFilter(false))checkSimpleSearch();}function checkFields(doFocus){var fs=document.simple_search.elements['p2g_sfield'];var vs=document.simple_search.elements['p2g_svalue'];if(fs.selectedIndex==0){if(doFocus!=null)fs.focus();return false;}else if(trim(vs.value)==""){if(doFocus!=null)vs.focus();return false;}else return true;}function viewFilters(){if(!filterViewState)buildFilterViewContent();o=document.getElementById('filter_view');if(!filterViewState)setStyleAttribute(o,'display','block');else setStyleAttribute(o,'display','none');filterViewState=!filterViewState;}function addFilter(verbose){if(checkFields(true)){if(!checkSearchValue()){alert(p2gInvalidVal);return false;}else{var fSI=document.simple_search.p2g_sfield.selectedIndex;var fC=document.simple_search.p2g_sfield;var oSI=document.simple_search.p2g_soperator.selectedIndex;var oC=document.simple_search.p2g_soperator;var vC=document.simple_search.p2g_svalue;var newExpr=String(fC.options[fSI].text+"|"+oC.options[oSI].text+"|"+vC.value+"|"+fC.options[fSI].value+"|"+oC.options[oSI].value);for(var i=0;i<searchExpressions.length;i++)if(searchExpressions[i]==newExpr)return false;searchExpressions[searchExpressions.length]=newExpr;if(verbose!=null&&verbose==true){buildFilterViewContent();alert(reportFilterOk);if(!filterViewState)viewFilters();}document.simple_search.p2g_svalue.value="";onlyFromCookie=false;return true;}}else
return false;}function removeFilter(remove){if(remove>=0){for(i=remove;i<(searchExpressions.length-1);i++)searchExpressions[i]=searchExpressions[i+1];searchExpressions.length--;}buildFilterViewContent();}function buildFilterViewContent(){var t="<table cellpadding=\"0\" cellspacing=\"0\" border=\"1\" bgcolor=\"#ffffff\" width=\"100%\"><tr><td width=\"100%\" valign=\"top\"><table cellpadding=\"6\" cellspacing=\"0\" border=\"0\" width=\"100%\">";if(searchExpressions.length>0){for(var i=0;i<searchExpressions.length;i++){values=searchExpressions[i].split('|');t=t+"<tr><td valign=\"top\" width=\"90%\"><span style=\"font-family:verdana;font-size:10px;color:#000000;text-decoration:none\">"+values[0]+" <b>"+values[1].toUpperCase()+"</b> "+values[2]+"</span></td><td align=\"right\" width=\"10%\" valign=\"top\"><a href=\"javascript:removeFilter("+i+");\" style=\"font-family:verdana;font-size:10px;color:#000000;text-decoration:none\"><b>["+reportFilRemove+"]</b></a></td></tr>";}}else t=t+"<tr><td valign=\"top\" width=\"100%\" colspan=\"2\"><span style=\"font-family:verdana;font-size:10px;color:#000000;text-decoration:none\">"+reportFilEmpty+"</span></td></tr>";t=t+"<tr><td align=\"right\" style=\"font-family:verdana;font-size:10px\" width=\"100%\" valign=\"top\" colspan=\"2\"><a href=\"javascript:viewFilters();\" style=\"font-family:verdana;font-size:10px;color:#000000;text-decoration:none\"><b>["+reportFilClose+"]</b></a></td></table></td></tr></table>";writeToDiv(getDivFromName('filter_view'),true,true,t);}function getActualMask(){var masksArray=document.simple_search.p2g_masks.value.split(",");var selField=document.simple_search.p2g_sfield.selectedIndex;if(selMask==masksArray[selField-1])return false;else{selMask=masksArray[selField-1];return true;}}function filterOperators(){if(getActualMask())rebuildOperators(selMask);}function rebuildOperators(mask){document.simple_search.p2g_svalue.value="";switch(mask){case"DATE":case"TIME":case"FLOAT":case"CURRENCY":case"INTEGER":list=document.simple_search.p2g_soperator;list.length=0;for(var i=0;i<reportOpsA.length;i+=2)list[list.length]=new Option(reportOpsA[i+1],reportOpsA[i]);list.options[0].selected=true;break;case"ZIP":case"URL":case"EMAIL":case"LOGIN":case"STRING":list=document.simple_search.p2g_soperator;list.length=0;for(var i=0;i<reportOpsB.length;i+=2)list[list.length]=new Option(reportOpsB[i+1],reportOpsB[i]);list.options[0].selected=true;break;default:list=document.simple_search.p2g_soperator;list.length=0;for(var i=0;i<reportOpsB.length;i+=2)list[list.length]=new Option(reportOpsB[i+1],reportOpsB[i]);list.options[0].selected=true;break;}}function checkSearchMask(field,event,dateFormat){if(document.simple_search.p2g_sfield.selectedIndex==0){document.simple_search.p2g_sfield.focus();return false;}else{if(!selMask)getActualMask();var rz=new RegExp("ZIP\-?([1-9])\:?([1-9])");var mz=rz.exec(selMask);if(mz)return chkMaskZIP(field,event,mz[1],mz[2]);var rf=new RegExp("FLOAT(\-([1-9][0-9]*)\:([1-9][0-9]*))?");var mf=rf.exec(selMask);if(mf)return(mf[2]&&mf[3]?chkMaskFLOAT(field,event,mf[2],mf[3]):chkMaskFLOAT(field,event));switch(selMask){case"INTEGER":return chkMaskINTEGER(field,event);break;case"DATE":return chkMaskDATE(field,event,filterDateFormat);break;case"TIME":return chkMaskTIME(field,event);break;case"EMAIL":return chkMaskEMAIL(field,event);break;case"URL":return chkMaskURL(field,event);break;case"CURRENCY":return chkMaskCURRENCY(field,event);break;case"LOGIN":return chkMaskLOGIN(field,event);break;default:return true;}}}function checkSearchValue(){if(document.simple_search.p2g_sfield.selectedIndex==0){document.simple_search.p2g_sfield.focus();return false;}else{getActualMask();field=document.simple_search.p2g_svalue;field.value=field.value.replace(/\|/g,"");var rz=new RegExp("ZIP\-?([1-9])\:?([1-9])");var mz=rz.exec(selMask);if(mz)return chkZIP(field,mz[1],mz[2]);var rf=new RegExp("FLOAT(\-([1-9][0-9]*)\:([1-9][0-9]*))?");var mf=rf.exec(selMask);if(mf)return(mf[2]&&mf[3]?chkFLOAT(field,mf[2],mf[3]):chkFLOAT(field));switch(selMask){case"INTEGER":return chkINTEGER(field);break;case"DATE":return chkDATE(field,filterDateFormat);break;case"TIME":return chkTIME(field);break;case"EMAIL":return chkEMAIL(field);break;case"URL":return chkURL(field);break;case"CURRENCY":return chkCURRENCY(field);break;case"LOGIN":return chkLOGIN(field);break;case"STRING":return true;default:return false;}}}